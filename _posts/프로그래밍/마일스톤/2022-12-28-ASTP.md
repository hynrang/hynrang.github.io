---
title:  "주식 자동매매 프로그램 ASTP"

categories: [프로그래밍, 마일스톤]
tags: [프로그래밍, 주식, 파이썬]

toc: true
toc_sticky: true
 
date: 2022-12-28
last_modified_at: 2023-05-04
---

# **들어가며**

**ASTP**[^1]는 내부 알고리즘으로 주식을 자동 매매하는 프로그램을 목표로 기획된 프로젝트로, **[제 두 번째 마일스톤](https://kiw6024.github.io/categories/%EB%A7%88%EC%9D%BC%EC%8A%A4%ED%86%A4/)**입니다. 기획 자체는 2021년 말에 했는데, 시작을 1년 뒤에 하기 시작해 2023년을 바라보는 날이 되어서야 완성을 했네요. 프로그램은 파이썬으로 작성했고, 현재로서는 단순한 전략을 따르는 형태로 간단히 완성했습니다. 주식 관련해서는 흥미가 많지 않아 지인의 작은 도움을 받았습니다.

# **특징**

[한국투자증권의 OpenAPI](https://www.truefriend.com/main/customer/systemdown/OpenAPI.jsp?cmd=TF04ea01200)를 사용했습니다. 프로그램을 작성하면서 API는 처음 사용해봤는데, 할 수 있는 것들이 어렵지 않게 많아져서 놀랐네요. 매매전략은 두 가지를 따르는데, 국내주식(KOSDAQ)이 아닌 **해외주식(NASDAQ)**을 기준으로 작동합니다.

- **주식 매수**: NDX 지수와 나스닥 상장 1, 2위 기업의 비율을 고려하여 주식을 매수합니다.
- **주식 매도**: NDX 지수가 폭락하거나 원달러 환율이 과도하게 상승할 경우 보유주식을 전량 매도하고 매매활동을 20영업일간 중지합니다. NDX 지수 폭락 여부는 주식장 시작과 종료 시점에 두 번씩 엑셀에 입력된 NDX 지수의 최대값과 최솟값을 비교하여 판단하도록 구성했습니다.

라이브러리도 여러 개 사용했는데, 대표적으로 한국투자증권의 OpenAPI 통합 파이썬 레퍼 모듈 `mojito`[^2], NASDAQ 시가총액 순위를 가져오기 위한 사용한 `yfinance`, 주식 관련 모듈 모두에서 누락되어있는 NASDAQ-100 수치를 크롤링으로 조달받기 위해 사용한 `BeautifulSoup` 등을 사용했습니다.

# **주의사항**

![ASTP_example](/assets/img/2022-12-28-ASTP/ASTP_example.png){: .w-50 .right }
_프로그램 실행 예시_

프로그램은 기본적으로 미리 작성된 알고리즘에 따라 NDX값을 조회한 후 조건에 따라 매수주문을 올리는 식으로 동작합니다.

재미있는 점은, 프로그램 외적으로 미국 장은 한국시간으로 밤 열한시 반부터 다음날 아침 여섯시 반까지 열리기 때문에 해외주식을 기반으로 하는 ASTP는 일반적인 프로그램과 다르게 코드 동작을 확인할 수 있는 시간에 제약이 있습니다.

이 콘솔창을 보기 위해 사전에 해야 하는 일이 조금 있습니다. 우선 공동인증서 모듈이 64bit 환경을 미지원하는 이슈가 있기 때문에, 불편하더라도 [32bit 가상환경을 임의적으로 구축하고,](https://kiw6024.github.io/posts/32bit/) 그 위에서 코드를 실행해야 합니다.

다음으로, 한국투자증권이 제공하는 서비스를 이용하기 위한 작업을 두 가지 해야 합니다. 먼저, 한국투자증권 계좌를 개설하고 [OpenAPI를 신청해야](https://apiportal.koreainvestment.com/intro) 합니다. 신청 페이지에서 `key`와 `secret`을 발급받아 해당 값을 가상 계좌번호와 함께 프로젝트 내 `mock.key`{: .filepath }에 저장하여 사용하기 위함입니다. 또, 주문 송수신이나 잔고조회 등을 처리하기 위해 한국투자증권이 제공하는 [eFriend Expert](https://www.truefriend.com/main/customer/systemdown/OpenAPI.jsp?cmd=TF04ea01200) 프로그램을 별도로 받아 설치해야 합니다.

# **마치며**

ASTP를 만들면서는 API나 라이브러리 등 기존에 만들어져있는 모듈을 찾고 활용하는 것이 가장 큰 경험이었던 것 같습니다. 이외에는 프로그램이 돌아가면서부터는 나스닥 지표나 각 기업의 시가총액 등 데이터가 정렬되는 것이 재미있었네요. 금융과 IT라는 테마가 흥미로워서였던 것 같습니다.

237줄 정도 되는 간단한 코드로 프로젝트를 마치지만, 이후에 이어서 프로그램을 확장하게 된다면 매수조건과 매도조건을 더 정교히 작성하고, 클래스화로 코드를 정리하는 작업을 진행할 것 같습니다.

마지막으로, 관심이 있는 분들은 [깃허브](https://github.com/kiw6024/ASTP)에서 둘러보실 수 있습니다.

<br>    

---

[^1]: **Auto Stock Trading Program**을 축약한 이름입니다.
[^2]: 이름의 유래가 재미있습니다. "돈 벌어서 몰디브가서 모히토 한 잔 하자"라는 의미가 [실제로](https://pypi.org/project/mojito2/) 담겨 있다고 합니다.